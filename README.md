## Flyway integration with Spring Boot

Spring boot application can automatically verify if DB schema is up-to-date, and run flyway migration scripts if there are new migration instructions. 

### Dependencies

First of all following dependencies should be added to `build.gradle` file:

    compile "org.flywaydb:flyway-core:4.2.0"
    compile group: 'org.springframework.boot', name: 'spring-boot-starter-data-jpa', version: '1.5.9.RELEASE'
    compile group: 'mysql', name: 'mysql-connector-java', version: '5.1.13'

`starter-data-jpa` and `mysql-connector-java` are required for DataSource autoconfiguration.

### Local configuration

For local configuration the information about MySQL instance should be provided manually. Let's create `application.properties` file in `scr/main/resources/` folder with the following content:

	spring.datasource.url= jdbc:mysql://localhost:3306/tracker_test
	spring.datasource.username= root
	spring.datasource.password=
	
>
>### Notice
>Correct username and password should be provided. 

### Migration files location
According to the flyway naming conventions the "migration files" should be located in `src/main/resources/db/migration/` folder.

let's copy the `databases/tracker/migrations/V1__initial_schema.sql` to the newly created `src/main/resources/db/migration/` folder. 

### Run application local
Now you can run application locally using:

	./gradlew bootRun
	
### Deploy to Cloud Foundry
Or deploy it to the cloud foundry:

	./gradlew clean build
	cf push
	
	
Take a look at log and try to find messages generated by flyway:

	...
	2017-11-29T12:31:16.36-0700 [APP/PROC/WEB/0] OUT 2017-11-29 19:31:16.359  INFO 14 --- [           main] o.f.c.i.dbsupport.DbSupportFactory       : Database: jdbc:mysql://192.168.16.87:3306/cf_b9c4eb6a_5938_4ce3_b71c_ca16d89b0fa9?user=CKwLLeydsXWr7uvO&password=xpwJmi5SH3qUpl4n (MySQL 5.5)
	2017-11-29T12:31:16.44-0700 [APP/PROC/WEB/0] OUT 2017-11-29 19:31:16.447  INFO 14 --- [           main] o.f.core.internal.command.DbValidate     : Successfully validated 1 migration (execution time 00:00.028s)
	2017-11-29T12:31:16.47-0700 [APP/PROC/WEB/0] OUT 2017-11-29 19:31:16.470  INFO 14 --- [           main] o.f.core.internal.command.DbMigrate      : Current version of schema `cf_b9c4eb6a_5938_4ce3_b71c_ca16d89b0fa9`: 1
	2017-11-29T12:31:16.47-0700 [APP/PROC/WEB/0] OUT 2017-11-29 19:31:16.472  INFO 14 --- [           main] o.f.core.internal.command.DbMigrate      : Schema `cf_b9c4eb6a_5938_4ce3_b71c_ca16d89b0fa9` is up to date. No migration necessary.
	2017-11-29T12:31:16.63-0700 [APP/PROC/WEB/0] OUT 2017-11-29 19:31:16.630  INFO 14 --- [           main] j.LocalContainerEntityManagerFactoryBean : Building JPA container EntityManagerFactory for persistence unit 'default'
	...